web安全
===


## web前端安全
前端安全主要表现为通过浏览器间接影响到用户数据的安全问题。

### XSS
参考：
* http://gitbook.cn/books/5a103941a953261c6a43368f/index.html

跨站脚本攻击(Cross Site Scripting)指的是恶意攻击者往Web页面里插入恶意Script代码，当用户浏览该页时，嵌入其中Web里面的Script代码会被执行（注入的JS代码跟网页原有的 JS 有同样的权限），从而达到恶意攻击用户的目的（比如盗取用户的cookie）。

有下列分类
* 反射性XSS
* 储存性XSS
* DOM XSS

XSS的问题是找到目标网站可插入执行脚本的漏洞，比如某段编辑内容，如果不处理用户的输入就直接存储到数据库中，则用户访问对页面时，恶意脚本被渲染到页面上，就可能执行对应的攻击。因此不要信任用户的输入，过滤掉常见的标签，script alert 尖括号<>等，在输入一些敏感字符的时候，要进行编码转换。

此外对比较敏感的cookie进行`http-only`限制，禁止客户端JS的访问权限

### CSRF
跨站请求伪造，指的是用了当前操作者的权限来偷偷地完成某个操作，比如目标网站的删除文章功能接受到来自恶意网站客户端发出的删除文章请求，这个请求是跨站点的，并且是伪造的（不是目标网站用户的本意）。

实现方式是在恶意网站上先构建一个GET请求（由于Ajax的同源限制，可以使用img的src请求等），然后欺骗目标网站用户访问该恶意网站，则在访问时会发起对应请求（并附带对应的Cookie等用户识别信息），此时攻击也会发生

可以通过检查origin和reffer、`samesite cookie`、表单提交时增加随机token参数等方式避免攻击

参考：
* [ 跨站请求伪造已死！](https://juejin.im/post/58c669b6a22b9d0058b3c630)
* [Cookie的SameSite属性](https://juejin.im/post/5c8a33dcf265da2dc538fc7d)

### 界面操作劫持
伪造钓鱼网站


## 语言安全

### JS原型污染

攻击者通过某种手段修改 JavaScript 对象的原型（prototype），然后影响浏览器或NodeJS环境下的代码

参考 
* [最新：Lodash 严重安全漏洞背后你不得不知道的 JavaScript 知识](https://juejin.im/post/5d271332f265da1b934e2d48)

### 如何防止代码被调试
页面不断debugger，当调试模式打开时，就会阻塞代码执行，当时间超过阈值，就发送到服务端并拉黑该ip

![](https://tva1.sinaimg.cn/large/006y8mN6gy1g91zxj25pmj30ms08v74o.jpg)

对应的破解方案

* [突破前端反调试--阻止页面不断debugger](https://segmentfault.com/a/1190000012359015)
## 后端安全

### SQL注入
恶意用户在前端的表单字段中进行SQL拼装，如果对用户的表单提交不进行校验，后端直接拿到数据就拼接 SQL 语句去查询数据库，最后生成的SQL就会有问题。

## 网络安全

### 中间人攻击

中间人攻击(Man-in-the-MiddleAttack，简称“MITM攻击”)是指攻击者与通讯的两端分别创建独立的联系，并交换其所收到的数据，使通讯的两端认为他们正在通过一个私密的连接与对方 直接对话，但事实上整个会话都被攻击者完全控制。

大致过程如下
* 服务器向客户端发送公钥。
* 攻击者截获公钥，保留在自己手上。然后攻击者自己生成一个【伪造的】公钥，发给客户端。
* 客户端收到伪造的公钥后，生成加密hash值发给服务器。
* 攻击者获得加密hash值，用自己的私钥解密获得真秘钥。同时生成假的加密hash值，发给服务器。
* 服务器用私钥解密获得假秘钥。

Fider、Charles等抓包工具实际上就是使用这种方式来截获https的信息的，因此当浏览器提示 遇见不可信任的证书时，需要注意证书的安全性。