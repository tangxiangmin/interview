
## HTTPS原理
参考：[升级博客到HTTPS](https://www.shymean.com/article/%E5%8D%87%E7%BA%A7%E5%8D%9A%E5%AE%A2%E5%88%B0HTTPS)，后面用伪代码整理了https的基本原理。

超文本传输安全协议（Hypertext Transfer Protocol Secure）HTTPS相对HTTP提供了更安全的数据传输保障。主要体现在三个方面：
* 内容加密。客户端到服务器的内容都是以加密形式传输，中间者无法直接查看明文内容。
* 身份认证。通过校验保证客户端访问的是自己的服务器。
* 数据完整性。防止内容被第三方冒充或者篡改。

需要了解两种加密方式
* 对称加密，服务端和客户端的加密和解密都使用相同的加密和解密方式，效率比较高，缺点是第一次发送时密钥可能被盗取，常见的对称加密算法有`DES`、`AES`等
* 公开密钥加密，服务端和客户端使用独立的加密解密方法，并通过对方的加密方法加密需要发送的报文，通过自己的解密方法接收对方发送的报文，安全性比较高，缺点是效率比较低，常见的非对称密钥加密算法有`RSA`、`DSA`等

为了提高安全性和效率，HTTPS结合了对称和非对称两种加密方式：在握手阶段使用公开密钥加密选择一种对称加密算法和密钥，然后在后续的通信阶段使用选择的对称加密算法和密钥进行通信。

使用公开密钥方式仍旧存在缺点，即无法保证传输的公开密钥是货真价实的，因此还需要使用数字证书，数字证书通常是由受信任的数字证书颁发机构CA，公钥就被包含在数字证书中。
* 在验证服务器身份后颁发证书，证书中包含了一个密钥对（公钥和私钥）和所有者识别信息。
* 在建立链接时，服务端发送者证书和到客户端，客户端使用证书对比签名，确认证书内的公钥是否是合法的，
* 如果是合法的，则将选择的某种对称加密方式加密后发送至服务端，完成密钥协商，然后继续后续的报文加密

为什么证书可以确保公开密钥的真实性呢？这是因为，证书是不能被伪造的，在签发证书时就会验证域名及域名所有者的身份。浏览器和系统内置了默认信任的证书，验证证书的过程如下
* 检查SSL证书是否由浏览器中“受信任的根证书颁发机构”颁发
* 检查部署SSL证书的网站域名是否与证书中一致
* 检查SSL证书中的证书吊销列表，证书是否被颁发机构吊销
* 检查此SSL证书是否过期
* 浏览器会到欺诈网站数据库查询此网站是否被列入黑名单

## 非对称加密

非对称加密算法是一种使用不同的密钥对进行加密和解密的加密算法。

它基于一对相关的密钥，包括公钥和私钥，公钥是公开的，可以被任何人获取，而私钥是保密的，只有密钥的拥有者可以访问。

### 加密解密

发送方使用接收方的公钥对明文进行加密。加密后的密文只能使用接收方的私钥进行解密。这意味着只有接收方能够解密和读取消息内容。

接收方使用自己的私钥对接收到的密文进行解密，从而还原出明文消息。私钥是保密的，确保只有接收方可以解密。

总结，加密和解密：使用接收方的公钥进行加密，然后使用接收方的私钥进行解密。只有拥有私钥的接收方才能解密加密数据。

### 数字签名和验签

非对称加密算法还可以用于数字签名。发送方使用自己的私钥对消息进行签名，生成一个唯一的数字摘要。接收方使用发送方的公钥对数字签名进行验证，以确保消息的完整性和认证性。

发送方：
a. 发送方对消息进行摘要计算，通常使用哈希函数，如SHA-256，生成消息的唯一指纹。
b. 发送方使用自己的私钥对摘要进行加密，生成数字签名。
c. 发送方将消息和数字签名发送给接收方。

接收方：
a. 接收方接收到消息和数字签名。
b. 接收方使用发送方的公钥对数字签名进行解密，得到解密后的摘要。
c. 接收方对接收到的消息进行摘要计算，得到自己的摘要。
d. 接收方将两个摘要进行比对，如果匹配，则消息的完整性得到验证，并且可以信任消息来自于发送方。

消息摘要算法的主要特征是加密过程不需要秘钥的参与，并且被加密过的数据无法被解密。只有输入相同的明文数据经过相同的数据摘要算法才能得到相同的密文。为了实现数字签名的验证过程，发送方和接收方需要约定相同的摘要计算算法，这样对相同的消息进行摘要时

总结，签名和验签：使用发送方的私钥进行签名，然后使用发送方的公钥进行验签。任何人都可以使用发送方的公钥验证签名的有效性。

### 证书

签名看起来就是私钥加密、公钥解密就行了，为什么还需要证书呢？

因为接收方并不能保证拿到的公钥是可靠的，这个时候就需要有某个机制来保证签名发起方的身份，这个机制就是证书。

证书由可信的第三方机构（证书颁发机构，Certificate Authority，简称CA）签发，包含签名发起者的公钥及相关信息，并由CA的私钥进行签名

接收方的系统一般内置了可信的第三方机构公钥，可以理解为接收方拿到的第三方机构公钥是可信的，这样他就可以使用CA的公钥验证证书的真实性，只要证书是可靠的，就可以认为证书里面签名发起者的公钥是可靠的。

只要签名的发起者的身份可信，就可以进行验签的工程。

因此，证书实际上就是一种确保签名方公钥可信的机制，具体来说，数字证书包含下面信息

* 证书版本号：标识证书的版本信息。
* 序列号：唯一标识证书的序列号，用于区分不同的证书。
* 签名算法标识：指示用于生成证书签名的算法，如RSA、SHA-256等。
* 颁发者信息：包含颁发证书的证书颁发机构（CA）的相关信息，如颁发者的名称、机构信息等。
* 有效期：指定证书的有效期限，包括起始日期和截止日期。
* 主体信息：包含证书持有者（签名发起者）的相关信息，如名称、电子邮件地址等。
* 公钥信息：包含证书持有者的公钥及其算法参数。
* 扩展信息：可选的扩展字段，用于存储其他的证书相关信息，如主题备用名称、密钥用途等。
* 签名算法标识：指示用于生成证书签名的算法。
* 签名值：使用证书颁发机构的私钥对证书的内容进行签名生成的签名值。

### mixed content警告

参考
* [混合内容 - mdn](https://developer.mozilla.org/zh-TW/docs/Web/Security/Mixed_content)

大概含义就是 https页面有http的内容，这些http的内容是不受加密保护的，恶意攻击者还是可以替换这部分内容用来攻击

分为被动混合内容和主动混合内容

被动混合内容包括img、audio、video、object的subresource等标签嵌入的内容

主动混合内容包括script、link、iframe、xhr、fetch、css中所有url引入的、object的data属性等地方引入的内容